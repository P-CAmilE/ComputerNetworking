# 第三章练习题

## P26

**a.** TCP的序号字段表示的数据首字节的**字节流编号**而不是报文段的编号。在考虑传输文件的最大值时，其实数据的首字节编号应该从0开，这样避免了对编号的浪费；同时最后一个报文段的序号加数据长度和不能超过$2^{32}-1$，保证接收方的确认报文段中确认好不会超出范围。在这种情况下总共传输的数据长度为$L = 2^{4*8}=4,294,967,296\;bytes$。

**b.** 因为题目中没有明确对报文段的数量限制，所以在此就实际情况出发，考虑发送报文段的最少数量的情况。在发送报文段的最少数量情况下，报文段的数量为$\lceil \frac{2^{32}}{536} \rceil = 8,012,999$，这些数量的报文段在最终发送到数据链路层后增加的传输字节长度为$8012999 \times 66= 528,857,934 \; bytes$，总的数据长度为$4294967296 + 528857934 = 4,823,825,230\;bytes‬$。在完美情况下传输这些内容所需时间为$4823825230‬ \div (155\times2^{17}) \approx 237.44 \; s$。

## P45

**a.** TCP吞吐量的宏观描述中，连接发送的分组数量以周期的形式变化，其中一个周期中数量是从$W/(2MSS)$到$W/MSS$每个$RRT$加一的形式增长的。在一个周期内丢包的数量为1，所以丢包率可以计算为：

$$\frac{1}{\frac{W}{2MSS}+(\frac{W}{2MSS}+1)+\cdots+\frac{W}{MSS}  } = \frac{1}{(\frac{w}{2MSS}+\frac{W}{MSS})\times\frac{w/(2MSS)+1}{2}} = \frac{1}{\frac{3W^2}{8MSS^2}+\frac{3W}{4MSS}}$$

> NOTE：对于题目中的证明，我们需要考虑的是$W$为窗口的最大长度，单位为$byte$，而最多的分组数量应该表示为$\frac{W}{MSS}$。所以题目中的证明应该是错误的。

**b.** 由于当$W$较大时，$\frac{W^2}{MSS^2} \gg \frac{W}{MSS}$，所以我们在计算丢包率$L$时近似的等于$\frac{8MSS^2}{3W^2}$，所以$W \approx \sqrt{\frac{8}{3L}}MSS$，带入平均数率的公式为：
$$平均数率 \approx \sqrt{\frac{3}{2}}\frac{MSS}{RTT\sqrt{L}} \approx \frac{1.22*MSS}{RTT\sqrt{L}}$$

## P46

**a.** 最大窗口长度即该TCP连接恰好发生丢包时的长度，此时链路完全用于传输该连接发送的分组。所以最大窗口长度为$W=\frac{10\times10^6}{8}\div\frac{1500}{0.15}=125$报文段。

**b.** 题中描述的情况满足**AIMD**拥塞控制方式，由于一直处于拥塞避免状态，此时窗口长度从$\frac{W}{2}$到$W$周期性变化，每个$RTT$增加一个报文段。

所以平均窗口长度为$\frac{W+W/2}{2}=0.75W\approx94$报文段，平均吞吐量为$\frac{94\times1500\times8}{0.15}\approx7520000\;bps$。

**c.** 首先计算出$cwnd$减半后的大小为$125/2\approx62$，所以丢包恢复时$cwnd$大小为62。在一个周期内，从丢包恢复到再次到达最大窗口，$cwnd$从62长到125一共需要$125-62=63$个$PTT$，恢复时间为$63\times0.15=9.45\;s$。